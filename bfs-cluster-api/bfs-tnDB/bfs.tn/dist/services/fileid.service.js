const a37_0x2ec8=['__metadata','FileidService','getAfidByMini','appendData','hex2Buffer','agfs','getPostfix','sha1','object','md5','../repositories/md5.repository','../lib/utils','TnodeRepository','agfidRepository','md5Repository','slice','decorate','afidRepository','afidOrSha512','afidAppender','getRealId','../config','Md5Repository','design:paramtypes','function','thisCluster','arfs','getOne','afid','length','Injectable','getLocation','../repositories/tnode.repository','date-fns','buffer2Hex','getAfid','getAfidByLite','__esModule','parse','getSha1','defineProperty','metadata','mini','getType','AfidRepository','lite','../repositories/afid.repository','getOwnPropertyDescriptor','agfidOrMd5','sha1Repository','getAgfid','../repositories/sha1.repository','AgfidRepository','tnodeRepository','assign'];(function(_0x1a8b31,_0x2ec8cc){const _0x313d47=function(_0x54e5b9){while(--_0x54e5b9){_0x1a8b31['push'](_0x1a8b31['shift']());}};_0x313d47(++_0x2ec8cc);}(a37_0x2ec8,0x6a));const a37_0x313d=function(_0x1a8b31,_0x2ec8cc){_0x1a8b31=_0x1a8b31-0x0;let _0x313d47=a37_0x2ec8[_0x1a8b31];return _0x313d47;};'use strict';var __decorate=this&&this['__decorate']||function(_0x5f2f52,_0x275192,_0x4cce5a,_0x201b4d){var _0x14c715=arguments[a37_0x313d('0x21')],_0x47afbe=_0x14c715<0x3?_0x275192:_0x201b4d===null?_0x201b4d=Object[a37_0x313d('0x33')](_0x275192,_0x4cce5a):_0x201b4d,_0x385dcb;if(typeof Reflect===a37_0x313d('0xc')&&typeof Reflect[a37_0x313d('0x14')]===a37_0x313d('0x1c'))_0x47afbe=Reflect['decorate'](_0x5f2f52,_0x275192,_0x4cce5a,_0x201b4d);else for(var _0xadc0e9=_0x5f2f52[a37_0x313d('0x21')]-0x1;_0xadc0e9>=0x0;_0xadc0e9--)if(_0x385dcb=_0x5f2f52[_0xadc0e9])_0x47afbe=(_0x14c715<0x3?_0x385dcb(_0x47afbe):_0x14c715>0x3?_0x385dcb(_0x275192,_0x4cce5a,_0x47afbe):_0x385dcb(_0x275192,_0x4cce5a))||_0x47afbe;return _0x14c715>0x3&&_0x47afbe&&Object[a37_0x313d('0x2c')](_0x275192,_0x4cce5a,_0x47afbe),_0x47afbe;};var __metadata=this&&this[a37_0x313d('0x4')]||function(_0x2c7375,_0x304309){if(typeof Reflect===a37_0x313d('0xc')&&typeof Reflect[a37_0x313d('0x2d')]===a37_0x313d('0x1c'))return Reflect['metadata'](_0x2c7375,_0x304309);};Object[a37_0x313d('0x2c')](exports,a37_0x313d('0x29'),{'value':!![]});const common_1=require('@nestjs/common');const date_fns_1=require(a37_0x313d('0x25'));const config_1=require(a37_0x313d('0x19'));const utils_1=require(a37_0x313d('0xf'));const afid_repository_1=require(a37_0x313d('0x32'));const agfid_repository_1=require('../repositories/agfid.repository');const md5_repository_1=require(a37_0x313d('0xe'));const sha1_repository_1=require(a37_0x313d('0x0'));const tnode_repository_1=require(a37_0x313d('0x24'));let FileidService=class FileidService{constructor(_0x28b6d4,_0x3ff51c,_0x3bca8c,_0x20763e,_0x6c234d){this[a37_0x313d('0x15')]=_0x28b6d4;this[a37_0x313d('0x11')]=_0x3ff51c;this[a37_0x313d('0x12')]=_0x3bca8c;this['sha1Repository']=_0x20763e;this[a37_0x313d('0x2')]=_0x6c234d;this[a37_0x313d('0x7')]={'mini':async(_0x479605,_0x497234,_0x121898)=>{await this[a37_0x313d('0x17')](_0x497234,_0x121898,utils_1['getPostfix'](_0x479605),{'mini':utils_1['hex2Buffer'](_0x479605)});},'md5':async(_0xa55fe2,_0x240f17,_0x4a14fa)=>{const _0x1c1b23=await this[a37_0x313d('0x12')]['getAfid'](_0x4a14fa,_0xa55fe2);if(!_0x1c1b23){return;}await this[a37_0x313d('0x17')](_0x240f17,_0x4a14fa,utils_1[a37_0x313d('0xa')](_0x1c1b23),{'afid':utils_1['hex2Buffer'](_0x1c1b23)});},'agfid':async(_0x13f90c,_0x25702a,_0x3b6ab1)=>{await this['agfidAppender'](_0x25702a,_0x3b6ab1,utils_1[a37_0x313d('0xa')](_0x13f90c),{'agfid':utils_1[a37_0x313d('0x8')](_0x13f90c)});},'sha1':async(_0x46eff4,_0x334cab,_0x548168)=>{const _0x57d7d1=await this['sha1Repository']['getAfid'](_0x548168,_0x46eff4);if(!_0x57d7d1){return;}await this[a37_0x313d('0x17')](_0x334cab,_0x548168,utils_1[a37_0x313d('0xa')](_0x57d7d1),{'afid':utils_1[a37_0x313d('0x8')](_0x57d7d1)});},'lite':async(_0x1f45e7,_0x46f1ab,_0x5059bd)=>{await this[a37_0x313d('0x17')](_0x46f1ab,_0x5059bd,utils_1[a37_0x313d('0xa')](_0x1f45e7),{'lite':utils_1[a37_0x313d('0x8')](_0x1f45e7)});},'afid':async(_0x2f99ba,_0x4b5f3a,_0x2df9b0)=>{await this['afidAppender'](_0x4b5f3a,_0x2df9b0,utils_1[a37_0x313d('0xa')](_0x2f99ba),{'afid':utils_1[a37_0x313d('0x8')](_0x2f99ba)});}};}['getType'](_0x30bfa1){switch(_0x30bfa1['length']){case 0x18:return a37_0x313d('0x2e');case 0x20:return this[a37_0x313d('0x34')](_0x30bfa1);case 0x28:return a37_0x313d('0xb');case 0x38:return a37_0x313d('0x31');case 0x80:return this['afidOrSha512'](_0x30bfa1);default:return'';}}async[a37_0x313d('0x23')](_0x5717ff,_0xb5f66){const _0x434690=await this[a37_0x313d('0x2')]['getAll']();const _0x3940ce={};for(const {cluster}of _0x434690){await this[a37_0x313d('0x7')][_0x5717ff](_0xb5f66,_0x3940ce,cluster);}return _0x3940ce;}async[a37_0x313d('0x18')](_0x364e04,_0x16887b){const _0x31b25b=this[a37_0x313d('0x2f')](_0x16887b);switch(_0x364e04){case'afs':return this[a37_0x313d('0x27')](_0x31b25b,_0x16887b);case a37_0x313d('0x1e'):return this['getAfid'](_0x31b25b,_0x16887b);case a37_0x313d('0x9'):return this[a37_0x313d('0x36')](_0x31b25b,_0x16887b);default:return'';}}async[a37_0x313d('0x27')](_0x5ba689,_0x1c73b4){switch(_0x5ba689){case a37_0x313d('0x2e'):return this['afidRepository'][a37_0x313d('0x6')](_0x1c73b4);case a37_0x313d('0xd'):return this[a37_0x313d('0x12')][a37_0x313d('0x27')](config_1[a37_0x313d('0x1d')],_0x1c73b4);case a37_0x313d('0xb'):return this[a37_0x313d('0x35')]['getAfid'](config_1[a37_0x313d('0x1d')],_0x1c73b4);case'lite':return this[a37_0x313d('0x15')][a37_0x313d('0x28')](_0x1c73b4);case a37_0x313d('0x20'):return _0x1c73b4;default:return'';}}['getAgfid'](_0x3fba21,_0x2dc0fc){switch(_0x3fba21){case'agfid':return _0x2dc0fc;default:return'';}}['agfidOrMd5'](_0x28dd22){const _0x509472=_0x28dd22[a37_0x313d('0x13')](0x6,0x14);const _0x2f1ce3=date_fns_1[a37_0x313d('0x2a')](_0x509472,config_1['datetimeFormat'],new Date());return isNaN(_0x2f1ce3['getTime']())?'md5':'agfid';}[a37_0x313d('0x16')](_0x3846c0){const _0x3366ec=_0x3846c0[a37_0x313d('0x13')](0x0,0x58);return utils_1[a37_0x313d('0x2b')](_0x3366ec)===_0x3846c0[a37_0x313d('0x13')](-0x28)?'afid':'';}async[a37_0x313d('0x17')](_0x592ec2,_0x254d3f,_0x11f330,_0x3458b2){const _0x24f207=await this[a37_0x313d('0x15')][a37_0x313d('0x1f')](_0x254d3f,_0x11f330,_0x3458b2);if(_0x24f207){_0x592ec2[_0x254d3f]=Object[a37_0x313d('0x3')](Object[a37_0x313d('0x3')]({},_0x24f207),{'afid':utils_1['buffer2Hex'](_0x24f207[a37_0x313d('0x20')]),'mini':utils_1[a37_0x313d('0x26')](_0x24f207['mini']),'lite':utils_1[a37_0x313d('0x26')](_0x24f207['lite'])});}}async['agfidAppender'](_0x3758ea,_0xa2bb86,_0xf2239b,_0x5d7168){const _0xe8c16a=await this['agfidRepository'][a37_0x313d('0x1f')](_0xa2bb86,_0xf2239b,_0x5d7168);if(_0xe8c16a){_0x3758ea[_0xa2bb86]=Object[a37_0x313d('0x3')](Object['assign']({},_0xe8c16a),{'agfid':utils_1[a37_0x313d('0x26')](_0xe8c16a['agfid'])});}}};FileidService=__decorate([common_1[a37_0x313d('0x22')](),__metadata(a37_0x313d('0x1b'),[afid_repository_1[a37_0x313d('0x30')],agfid_repository_1[a37_0x313d('0x1')],md5_repository_1[a37_0x313d('0x1a')],sha1_repository_1['Sha1Repository'],tnode_repository_1[a37_0x313d('0x10')]])],FileidService);exports[a37_0x313d('0x5')]=FileidService;